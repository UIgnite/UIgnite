{"name":"videoplayer","type":"registry:ui","dependencies":[],"registryDependencies":["https://d278-104-28-199-190.ngrok-free.app/r/videoplayer.json"],"files":[{"path":"components/ui/VideoPlayer.tsx","type":"registry:ui","content":"import {cn} from '@/lib/utils';\nimport React, {\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n  MouseEvent,\n  useReducer,\n} from 'react';\n\nexport interface VideoPlayerProps {\n  thumbnailUrl?: string;\n  muted?: boolean;\n  autoplay?: boolean;\n  loop?: boolean;\n  src: string;\n  srcType?: string;\n  defaultVolume?: number;\n  className?: string;\n}\n\nenum SpeedReducerActionKind {\n  INCREASE = 'INCREASE',\n  DECREASE = 'DECREASE',\n}\n\ninterface SpeedReducerActionT {\n  type: SpeedReducerActionKind;\n}\n\ninterface SpeedReducerStateT {\n  speed: number;\n}\n\nfunction speedReducer(\n  state: SpeedReducerStateT,\n  action: SpeedReducerActionT\n): SpeedReducerStateT {\n  const {type} = action;\n  switch (type) {\n    case SpeedReducerActionKind.INCREASE:\n      return {\n        ...state,\n        speed: state.speed + 1,\n      };\n    case SpeedReducerActionKind.DECREASE:\n      return {\n        ...state,\n        speed: state.speed >= 0 ? state.speed - 1 : state.speed,\n      };\n    default:\n      return state;\n  }\n}\n\nfunction VideoPlayer({\n  src,\n  thumbnailUrl,\n  muted = false,\n  autoplay = false,\n  loop = false,\n  srcType,\n  defaultVolume = 20,\n  className = '',\n}: VideoPlayerProps) {\n  const videoRef = useRef<HTMLVideoElement | null>(null);\n  const progressRef = useRef<HTMLDivElement | null>(null);\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  const [played, setPlayed] = useState(false);\n  const [playing, setPlaying] = useState(false);\n  const [fullScreenMode, setFullScreenMode] = useState(false);\n  const [isMuted, setIsMuted] = useState(muted);\n\n  const [currentTime, setCurrentTime] = useState(0);\n  const [videoDuration, setVideoDuration] = useState(0);\n\n  const [volumeRange, setVolumeRange] = useState(defaultVolume);\n\n  const [volumeBtnHovered, setVolumeBtnHovered] = useState(false);\n  const [settingsBtnHovered, setSettingsBtnHovered] = useState(false);\n\n  const [state, dispatch] = useReducer(speedReducer, {speed: 1});\n\n  const handleTooglePlaying = useCallback(() => {\n    setPlayed(true);\n    if (videoRef.current) {\n      if (!playing) videoRef.current.play();\n      else videoRef.current.pause();\n    }\n  }, [playing, videoRef.current]);\n\n  useEffect(() => {\n    let timeout: NodeJS.Timeout;\n    if (autoplay && !played) timeout = setTimeout(handleTooglePlaying, 0);\n\n    return () => {\n      if (timeout) clearTimeout(timeout);\n    };\n  }, [autoplay, videoRef.current, played]);\n\n  useEffect(() => {\n    const controller = new AbortController();\n\n    if (videoRef.current) {\n      videoRef.current.addEventListener('play', () => setPlaying(true), {\n        signal: controller.signal,\n      });\n\n      videoRef.current.addEventListener('pause', () => setPlaying(false), {\n        signal: controller.signal,\n      });\n\n      videoRef.current.addEventListener(\n        'fullscreenchange',\n        () => setFullScreenMode(!fullScreenMode),\n        {signal: controller.signal}\n      );\n\n      videoRef.current.addEventListener(\n        'contextmenu',\n        (evt) => evt.preventDefault(),\n        {signal: controller.signal}\n      );\n\n      videoRef.current.addEventListener(\n        'timeupdate',\n        () => {\n          if (videoRef.current) {\n            setCurrentTime(videoRef.current.currentTime);\n            setVideoDuration(videoRef.current.duration);\n          }\n        },\n        {signal: controller.signal}\n      );\n    }\n\n    return () => {\n      controller.abort();\n    };\n  }, [fullScreenMode, videoRef.current]);\n\n  const handleCurrentTimeChangeClick = useCallback(\n    (evt: MouseEvent<HTMLDivElement>) => {\n      const box = progressRef.current?.getBoundingClientRect();\n      if (videoRef.current && box) {\n        const time =\n          (((evt.clientX - box.x) / box.width) * 100 * videoDuration) / 100;\n        videoRef.current.currentTime = time;\n      }\n    },\n    [videoDuration, videoRef.current, progressRef]\n  );\n\n  const handleToogleFullScreenMode = useCallback(() => {\n    if (containerRef.current) {\n      if (!fullScreenMode) {\n        containerRef.current.requestFullscreen();\n      } else {\n        document.exitFullscreen();\n      }\n      setFullScreenMode(!fullScreenMode);\n    }\n  }, [fullScreenMode, containerRef, setFullScreenMode]);\n\n  React.useEffect(() => {\n    if (videoRef.current) videoRef.current.volume = volumeRange / 100;\n  }, [volumeRange]);\n\n  useEffect(() => {\n    if (videoRef.current) videoRef.current.playbackRate = state.speed;\n  }, [state.speed]);\n\n  return (\n    <div\n      ref={containerRef}\n      style={{\n        width: 741,\n        height: 416,\n      }}\n      className={cn(\n        'relative group shadow-xl rounded overflow-hidden',\n        className\n      )}\n      data-played={played}\n    >\n      <style>\n        {`\n            .parent-volume:hover .child-volume {\n              opacity: 1;\n              height: 20px;\n            }\n            .parent-progress:hover .child-progress {\n              height: 8px;\n            }\n          `}\n      </style>\n      <video\n        preload=\"true\"\n        ref={videoRef}\n        hidden={!played}\n        muted={isMuted}\n        loop={loop}\n        autoPlay={autoplay}\n        className=\"w-full h-full\"\n      >\n        <source src={src} type={srcType ?? 'video/mp4'} />\n      </video>\n      {thumbnailUrl ? (\n        <img\n          hidden={played}\n          className=\"w-full h-full object-cover\"\n          src={thumbnailUrl || 'https://picsum.photos/seed/picsum/1482/812'}\n          alt=\"Video thumbnail\"\n        />\n      ) : null}\n      <div onClick={handleTooglePlaying} className=\"z-2 absolute inset-0\" />\n\n      {/* Controls */}\n      <div\n        style={{\n          opacity: !played ? 1 : undefined,\n        }}\n        data-type=\"controlls\"\n        className=\"absolute bottom-2 right-2 left-2 z-10 h-8 flex items-center gap-x-2 group-hover:opacity-100 duration-300 transition-opacity opacity-0 ease-in-out\"\n      >\n        {/* Play / Pause */}\n        <button\n          onClick={handleTooglePlaying}\n          className=\"px-4 py-1 bg-black/90 rounded cursor-pointer hover:fill-black/90 fill-neutral-100 hover:bg-white/90\"\n        >\n          {playing ? (\n            <svg className=\"size-6\">\n              <path\n                fillRule=\"evenodd\"\n                clipRule=\"evenodd\"\n                d=\"M8 4a2 2 0 00-2 2v12a2 2 0 104 0V6a2 2 0 00-2-2zm8 0a2 2 0 00-2 2v12a2 2 0 104 0V6a2 2 0 00-2-2z\"\n              />\n            </svg>\n          ) : (\n            <svg viewBox=\"0 0 24 24\" className=\"size-6\">\n              <path d=\"M19 12a1 1 0 01-.496.864l-12 7A1 1 0 015 19V5a1 1 0 011.504-.864l12 7A1 1 0 0119 12z\" />\n            </svg>\n          )}\n        </button>\n\n        {/* Progress Bar */}\n        <div className=\"w-full bg-black/90 h-full px-1 rounded flex gap-x-0.5 items-center\">\n          <div className=\"px-2 w-full\">\n            <div\n              onClick={handleCurrentTimeChangeClick}\n              ref={progressRef}\n              className=\"w-full h-full parent-progress flex items-center cursor-pointer\"\n            >\n              <div className=\"w-full h-1 bg-neutral-800 overflow-hidden child-progress rounded-md transition-all\">\n                <div\n                  style={{\n                    width:\n                      currentTime === 0\n                        ? '0%'\n                        : `${(currentTime / videoDuration) * 100}%`,\n                  }}\n                  className=\"bg-neutral-100 rounded-md h-full\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Volume */}\n          <div\n            onMouseEnter={() => setVolumeBtnHovered(true)}\n            onMouseLeave={() => setVolumeBtnHovered(false)}\n            className=\"px-1 py-1 cursor-pointer relative flex items-center\"\n          >\n            <div\n              style={{\n                opacity: volumeBtnHovered ? 1 : 0,\n              }}\n              className=\"absolute transition-opacity opacity-0 -top-24 left-0 z-30 right-0 flex\"\n            >\n              <div className=\"h-full w-full bg-black/90 flex flex-col items-center justify-center relative rounded-md py-3\">\n                <input\n                  value={volumeRange}\n                  onChange={(e) => {\n                    if (+e.target.value > 0 && !isMuted) setIsMuted(false);\n                    setVolumeRange(+e.target.value);\n                  }}\n                  min={1}\n                  max={100}\n                  type=\"range\"\n                  className=\"h-16 rounded-md slider\"\n                  style={{\n                    writingMode: 'sideways-lr',\n                    appearance: 'none',\n                    background: `linear-gradient(to top, #f5f5f5 0%, #f5f5f5 ${volumeRange}%, #a1a1a1 ${volumeRange}%, #a1a1a1 100%)`,\n                    width: '4px',\n                  }}\n                />\n              </div>\n            </div>\n            <button\n              onClick={() =>\n                volumeRange == 0 ? setVolumeRange(20) : setVolumeRange(0)\n              }\n              className=\"cursor-pointer my-auto\"\n            >\n              {volumeRange > 0 ? (\n                <svg\n                  viewBox=\"0 0 24 24\"\n                  className=\"size-5 fill-neutral-100 dark:fill-neutral-100\"\n                >\n                  <path\n                    fillRule=\"evenodd\"\n                    clipRule=\"evenodd\"\n                    d=\"M20 12c0 3.728-2.55 6.86-6 7.748V21.8c4.564-.927 8-4.962 8-9.8 0-4.838-3.436-8.873-8-9.8v2.052c3.45.888 6 4.02 6 7.748zm-2 0a6.002 6.002 0 00-4-5.659v2.194c1.196.692 2 1.984 2 3.465 0 1.48-.804 2.773-2 3.465v2.194c2.33-.824 4-3.047 4-5.659zM6.586 8.004H4a2 2 0 00-2 2v4a2 2 0 002 2h2.586l3.707 4.707c.63.63 1.707.184 1.707-.707v-16c0-.89-1.077-1.337-1.707-.707L6.586 8.004z\"\n                  />\n                </svg>\n              ) : (\n                <svg\n                  viewBox=\"0 0 24 24\"\n                  className=\"size-5 fill-neutral-100 dark:fill-neutral-100\"\n                >\n                  <path\n                    fillRule=\"evenodd\"\n                    clipRule=\"evenodd\"\n                    d=\"M14 2.20001C15.1263 2.42863 16.1838 2.84654 17.1379 3.41908L15.5513 4.82943C15.0606 4.58595 14.5414 4.39136 14 4.25201V2.20001ZM21.1249 7.90287L19.5378 9.31361C19.8371 10.1532 20 11.0576 20 12C20 15.7277 17.4505 18.8599 14 19.7479V21.7999C18.5645 20.8734 22 16.8379 22 12C22 10.5401 21.6872 9.15325 21.1249 7.90287ZM12 4.00396V7.98614L3.17811 15.8278C2.48346 15.5143 2 14.8156 2 14.004V10.004C2 8.89939 2.89543 8.00396 4 8.00396H6.58579L10.2929 3.29685C10.9229 2.66689 12 3.11305 12 4.00396ZM12 10.662L5.99037 16.004L2.33565 19.2526C1.92286 19.6195 1.88568 20.2516 2.2526 20.6644C2.61952 21.0772 3.25159 21.1143 3.66437 20.7474L21.6644 4.74742C22.0772 4.3805 22.1143 3.74843 21.7474 3.33565C21.3805 2.92286 20.7484 2.88568 20.3356 3.2526L12 10.662ZM10.2929 20.7111L8.81985 18.8407L12 16.0139V20.004C12 20.8949 10.9229 21.341 10.2929 20.7111ZM14 15.4648C15.0633 14.8498 15.8172 13.7593 15.971 12.4841L17.8778 10.7892C17.9579 11.1803 18 11.5852 18 12C18 14.6124 16.3304 16.8349 14 17.6586V15.4648Z\"\n                  ></path>\n                </svg>\n              )}\n            </button>\n          </div>\n\n          {/* Captions */}\n          <div className=\"px-1 py-1 cursor-pointer\" data-ctrltype=\"captions\">\n            <button\n              onClick={() =>\n                volumeRange == 0 ? setVolumeRange(20) : setVolumeRange(0)\n              }\n              className=\"flex items-center justify-center cursor-pointer\"\n            >\n              <svg\n                viewBox=\"0 0 24 24\"\n                className=\"fill-neutral-100 size-5 dark:fill-neutral-100\"\n              >\n                <path\n                  fillRule=\"evenodd\"\n                  clipRule=\"evenodd\"\n                  d=\"M20 6H4v12h16V6zM4 4a2 2 0 00-2 2v12a2 2 0 002 2h16a2 2 0 002-2V6a2 2 0 00-2-2H4zm7.486 8.824c-.112.697-.4 1.273-.855 1.714-.463.445-1.062.671-1.778.671-.882 0-1.588-.303-2.097-.903C6.254 13.713 6 12.897 6 11.878c0-1.102.288-1.966.856-2.571C7.36 8.772 8.01 8.5 8.784 8.5c1.03 0 1.799.365 2.284 1.085.263.4.407.81.428 1.216l.01.18H9.967l-.035-.127c-.07-.27-.16-.471-.265-.6-.186-.226-.457-.335-.834-.335-.374 0-.663.158-.883.484-.23.343-.348.845-.348 1.494 0 .643.121 1.126.36 1.433.232.3.517.445.87.445.364 0 .632-.12.82-.371.107-.138.198-.357.272-.647l.031-.128H11.517l-.031.195zm5.628 1.714c.455-.44.743-1.017.854-1.714l.032-.195h-1.56l-.032.128c-.074.29-.165.509-.273.647-.187.25-.456.37-.82.37-.352 0-.636-.145-.868-.444-.239-.307-.361-.79-.361-1.433 0-.649.117-1.15.35-1.494.217-.326.507-.484.881-.484.376 0 .649.11.833.335.106.129.196.33.267.6l.033.126h1.538l-.008-.179c-.023-.407-.166-.816-.43-1.216-.485-.72-1.252-1.085-2.283-1.085-.776 0-1.424.272-1.928.807-.568.605-.856 1.47-.856 2.57 0 1.02.254 1.836.755 2.43.51.599 1.215.902 2.098.902.716 0 1.314-.226 1.778-.671z\"\n                />\n              </svg>\n            </button>\n          </div>\n\n          {/* Settings */}\n          <div\n            onMouseEnter={() => setSettingsBtnHovered(true)}\n            onMouseLeave={() => setSettingsBtnHovered(false)}\n            className=\"px-1 py-1 cursor-pointer relative parent-settings\"\n          >\n            <div\n              style={{\n                opacity: settingsBtnHovered ? 1 : 0,\n              }}\n              className=\"absolute transition-opacity opacity-0 bottom-9 w-20 h-8 z-20 -right-7 flex\"\n            >\n              <div className=\"h-full w-full bg-black/90 gap-x-2 flex text-xs items-center px-2 justify-center relative rounded-md py-3\">\n                <button\n                  onClick={() =>\n                    dispatch({type: SpeedReducerActionKind.DECREASE})\n                  }\n                  className=\"cursor-pointer hover:bg-neutral-600 py-2 px-2 rounded-md\"\n                >\n                  <svg className=\"size-2 -rotate-90\" viewBox=\"0 -4.5 24 24\">\n                    <path\n                      d=\"M23.345 11.39L13.615.6a2.087 2.087 0 00-1.631-.61 2.085 2.085 0 00-1.63.61L.624 11.39a2.136 2.136 0 000 3.01c.828.83 2.169.83 2.997 0l8.363-9.27 8.365 9.27c.827.83 2.169.83 2.996 0s.827-2.18 0-3.01\"\n                      fill=\"#fff\"\n                      fillRule=\"evenodd\"\n                    />\n                  </svg>\n                </button>\n                <div>{state.speed}x</div>\n                <button\n                  onClick={() =>\n                    dispatch({type: SpeedReducerActionKind.INCREASE})\n                  }\n                  className=\"cursor-pointer hover:bg-neutral-600 py-2 px-2 rounded-md\"\n                >\n                  <svg className=\"size-2 rotate-90\" viewBox=\"0 -4.5 24 24\">\n                    <path\n                      d=\"M23.345 11.39L13.615.6a2.087 2.087 0 00-1.631-.61 2.085 2.085 0 00-1.63.61L.624 11.39a2.136 2.136 0 000 3.01c.828.83 2.169.83 2.997 0l8.363-9.27 8.365 9.27c.827.83 2.169.83 2.996 0s.827-2.18 0-3.01\"\n                      fill=\"#fff\"\n                      fillRule=\"evenodd\"\n                    />\n                  </svg>\n                </button>\n              </div>\n            </div>\n            <svg className=\"fill-neutral-100 size-5 dark:fill-neutral-100\">\n              <path\n                clipRule=\"evenodd\"\n                d=\"M9.167 1.667c-.92 0-1.667.746-1.667 1.667v1.394a5.828 5.828 0 00-.815.472L5.47 4.498a1.666 1.666 0 00-2.27.612l-.835 1.447a1.664 1.664 0 00.605 2.271l1.215.702a5.912 5.912 0 000 .94l-1.215.702a1.664 1.664 0 00-.605 2.272L3.2 14.89a1.666 1.666 0 002.27.613l1.215-.702c.257.178.53.336.815.471v1.395c0 .92.746 1.667 1.667 1.667h1.666c.92 0 1.667-.747 1.667-1.667v-1.395c.285-.135.557-.293.815-.471l1.215.702c.788.455 1.81.184 2.269-.613l.835-1.446a1.664 1.664 0 00-.604-2.272l-1.215-.701a5.907 5.907 0 000-.941l1.215-.702a1.664 1.664 0 00.604-2.271L16.8 5.11a1.666 1.666 0 00-2.27-.612l-1.214.702a5.824 5.824 0 00-.815-.472V3.334c0-.92-.746-1.667-1.667-1.667H9.167zM12.5 10a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z\"\n              />\n            </svg>\n          </div>\n\n          {/* Fullscreen */}\n          <button\n            onClick={handleToogleFullScreenMode}\n            className=\"px-1 py-1 cursor-pointer\"\n            data-ctrltype=\"fullscreen\"\n          >\n            <svg\n              viewBox=\"0 0 512 512\"\n              xmlSpace=\"preserve\"\n              className=\"size-4 fill-neutral-100 dark:fill-neutral-100\"\n            >\n              <path d=\"M345.495 0l49.012 49.023-106.584 106.584 68.461 68.479 106.603-106.593 49.004 49.022V0zM155.615 287.914L49.022 394.507.009 345.494V512h166.506l-49.022-49.022 106.594-106.603zM356.384 287.914l-68.461 68.461 106.584 106.603L345.495 512h166.496V345.485l-49.014 49.022zM166.505 0H.009v166.506l49.013-49.013 106.593 106.593 68.472-68.479L117.501 49.023z\" />{' '}\n              {/* trimmed for brevity */}\n            </svg>\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport {VideoPlayer};\n","filename":"VideoPlayer"}],"$schema":"https://ui.shadcn.com/schema/registry-item.json"}